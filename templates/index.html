<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
    <style>
        body { margin:0; font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
        .container { display: flex; height: 100vh; }
        .side-menu { width: 250px; background: #2f353e; color: #eee; display: flex; flex-direction: column; overflow-y: auto; }
        .side-menu h2 { font-size: 1.2rem; margin: 20px; color: #ccc; }
        .category { margin:0; padding:0; border-bottom:1px solid #444; }
        .category-title { padding:10px 20px; cursor:pointer; background:#394049; font-weight:bold; user-select:none; }
        .category-items { display:none; flex-direction:column; }
        .category-items button { padding:10px 20px; border:none; text-align:left; background:#2f353e; color:#eee; cursor:pointer; outline:none; }
        .category-items button:hover { background:#3f4650; }
        .main-area { flex:1; display:flex; flex-direction:column; background:#fff; }
        .terminal-top-bar { background:#ddd; padding:10px; display:flex; justify-content:flex-end; align-items:center; }
        .terminal-top-bar select { padding:5px; margin-left:10px; }
        .terminal-container { flex:1; background:#1e1e1e; display:flex; flex-direction:column; overflow:hidden; }
        #terminal { flex:1; overflow:hidden; }
    </style>
</head>
<body>
    <div class="container">
        <div class="side-menu">
            <h2>Commands</h2>
            <div class="category">
                <div class="category-title">Basic Bash</div>
                <div class="category-items">
                    <button data-command="echo hello">echo hello</button>
                    <button data-command="uname -a">os version</button>
                    <button data-command="ifconfig">ip and mac</button>
                    <button data-command="top">running processes</button>
                    <button data-command="which python">python location</button>
                    <button data-command="pip list -v">modules locations</button>
                    <button data-command='printf "%-30s %-10s %-10s %-15s\n" "Name" "Size" "Lines" "Permissions"; for file in .* *; do [ -e "$file" ] || continue; size=$(du -sh "$file" 2>/dev/null | awk "{print \$1}"); perms=$(stat -c "%A" "$file" 2>/dev/null); lines=$( [ -f "$file" ] && wc -l < "$file" || echo "N/A" ); printf "%-30s %-10s %-10s %-15s\n" "$file" "$size" "$lines" "$perms"; done'>list of files</button>
                    <button data-command="find . -regex '.*sers/Henriq.*.jpg'">search files by name</button>
                    <button data-command="grep -Rl 'Henrique' .">search files by content</button>
                    <button data-command="grep -l 'Henrique' *">search <b>lines</b> with certain text</button>

                </div>
            </div>

            <div class="category">
                <div class="category-title">XXXXX</div>
                <div class="category-items">
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                </div>
            </div>
            <div class="category">
                <div class="category-title">XXXXX</div>
                <div class="category-items">
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                </div>
            </div>
            <div class="category">
                <div class="category-title">XXXXX</div>
                <div class="category-items">
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                    <button data-command="xxx">xxx</button>
                </div>
            </div>
        </div>
        <div class="main-area">
            <div class="terminal-top-bar">
                <span>Choose Terminal:</span>
                <select id="terminalSelector">
                    {% for shell in shells %}
                    <option value="{{ shell.name }}" {% if not shell.available %}disabled{% endif %}>
                        {{ shell.name }}{% if not shell.available %} (unavailable){% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="terminal-container">
                <div id="terminal"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script>
        // Determine correct ws or wss
        var protocol = (window.location.protocol === 'https:') ? 'wss://' : 'ws://';

        // Toggle categories
        document.querySelectorAll('.category-title').forEach(title => {
            title.addEventListener('click', () => {
                const items = title.nextElementSibling;
                if (items.style.display === 'flex') {
                    items.style.display = 'none';
                } else {
                    items.style.display = 'flex';
                }
            });
        });

        const term = new Terminal({ 
            cols: 80, 
            rows: 24, 
            fontSize:14, 
            theme: { background: '#1e1e1e' } 
        });
        term.open(document.getElementById('terminal'));

        let ws;
        let currentShell = document.getElementById('terminalSelector').value;

        function connectTerminal(shellType) {
            if (ws) ws.close();
            ws = new WebSocket(protocol + window.location.host + "/ws");
            ws.onopen = () => {
                ws.send(shellType);
            };
            ws.onmessage = (event) => {
                term.write(event.data);
            };
            ws.onclose = () => {
                term.write("\r\n*** Disconnected from server ***\r\n");
            };
        }

        connectTerminal(currentShell);

        term.onData(data => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(data);
            }
        });

        document.getElementById('terminalSelector').addEventListener('change', (e) => {
            // If shell is disabled (unavailable), ignore
            if (e.target.selectedOptions[0].disabled) {
                alert("This shell is not available on this system.");
                // revert to previous selection
                e.target.value = currentShell;
                return;
            }
            currentShell = e.target.value;
            connectTerminal(currentShell);
        });

        document.querySelectorAll('.category-items button').forEach(btn => {
            btn.addEventListener('click', () => {
                const command = btn.getAttribute('data-command');
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(command + "\r");
                }
            });
        });
    </script>
</body>
</html>
